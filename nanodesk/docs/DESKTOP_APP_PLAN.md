# Nanodesk Desktop å¼€å‘è®¡åˆ’ä¹¦

> Windows æ¡Œé¢å®¢æˆ·ç«¯å¼€å‘è§„åˆ’ï¼ˆPhase 1ï¼‰
> 
> ç‰ˆæœ¬: 1.0 | æ—¥æœŸ: 2026-02-12 | å¹³å°: **Windows 10/11 only**
> 
> å®šä½ï¼šæ™®é€šç”¨æˆ·ï¼ˆéæŠ€æœ¯èƒŒæ™¯ï¼‰ï¼Œé™ä½ä½¿ç”¨é—¨æ§›

---

## 1. é¡¹ç›®ç›®æ ‡

ä¸ºæ™®é€šç”¨æˆ·æä¾›ä¸€é”®å®‰è£…ã€å›¾å½¢åŒ–é…ç½®çš„ Nanodesk æ¡Œé¢å®¢æˆ·ç«¯ï¼Œé™ä½æŠ€æœ¯é—¨æ§›ã€‚

### æ ¸å¿ƒåŠŸèƒ½ï¼ˆPhase 1ï¼‰
- [ ] å›¾å½¢åŒ–é…ç½®å‘å¯¼ï¼ˆé¦–æ¬¡å¯åŠ¨ï¼‰
- [ ] ç³»ç»Ÿæ‰˜ç›˜å¯åŠ¨å™¨ï¼ˆå¯åŠ¨/åœæ­¢/çŠ¶æ€ï¼‰
- [ ] å¤šæ¨¡å‹ Provider é…ç½®
- [ ] è¿›ç¨‹ç®¡ç†ï¼ˆGateway ç”Ÿå‘½å‘¨æœŸï¼‰

---

## 2. æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | è¯´æ˜ |
|------|------|------|
| GUI æ¡†æ¶ | PySide6 | Qt6 ç»‘å®šï¼Œç°ä»£åŒ–ç•Œé¢ï¼Œä¸­æ–‡æ”¯æŒå¥½ |
| æ‰“åŒ…å·¥å…· | PyInstaller | ç”Ÿæˆå•æ–‡ä»¶ exe |
| å®‰è£…ç¨‹åº | Inno Setup | ä¸“ä¸š Windows å®‰è£…åŒ… |
| é…ç½®åŠ å¯† | Windows DPAPI | ä¿æŠ¤ API Key |
| è¿›ç¨‹ç®¡ç† | asyncio + subprocess | å¼‚æ­¥ç®¡ç†åå°è¿›ç¨‹ |

---

## 3. é¡¹ç›®ç»“æ„

```
nanodesk/
â”œâ”€â”€ desktop/                    # æ¡Œé¢åº”ç”¨ä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                 # ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ app.py                  # QApplication å®ä¾‹
â”‚   â”œâ”€â”€ windows/
â”‚   â”‚   â”œâ”€â”€ main_window.py      # ä¸»çª—å£ï¼ˆæ‰˜ç›˜ + çŠ¶æ€ï¼‰
â”‚   â”‚   â””â”€â”€ setup_wizard.py     # é…ç½®å‘å¯¼ï¼ˆ3æ­¥éª¤ï¼‰
â”‚   â”œâ”€â”€ widgets/
â”‚   â”‚   â”œâ”€â”€ provider_card.py    # Provider é…ç½®å¡ç‰‡
â”‚   â”‚   â”œâ”€â”€ channel_card.py     # é¢‘é“é…ç½®å¡ç‰‡
â”‚   â”‚   â””â”€â”€ status_indicator.py # çŠ¶æ€æŒ‡ç¤ºç¯
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ config_manager.py   # é…ç½®ç®¡ç†ï¼ˆè¯»å†™/åŠ å¯†ï¼‰
â”‚   â”‚   â”œâ”€â”€ process_manager.py  # Gateway è¿›ç¨‹ç®¡ç†
â”‚   â”‚   â””â”€â”€ system_tray.py      # ç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡
â”‚   â””â”€â”€ resources/
â”‚       â”œâ”€â”€ icons/
â”‚       â”‚   â”œâ”€â”€ tray_icon.ico   # æ‰˜ç›˜å›¾æ ‡
â”‚       â”‚   â””â”€â”€ logo.png        # åº”ç”¨å›¾æ ‡
â”‚       â””â”€â”€ styles.qss          # æ ·å¼è¡¨
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ build_desktop.ps1       # æ‰“åŒ…è„šæœ¬
â””â”€â”€ installer/
    â”œâ”€â”€ nanodesk.iss            # Inno Setup è„šæœ¬
    â””â”€â”€ assets/
        â””â”€â”€ banner.bmp          # å®‰è£…ç•Œé¢æ¨ªå¹…
```

---

## 4. ç•Œé¢åŸå‹

### 4.1 é…ç½®å‘å¯¼

**Step 1: LLM Provider**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Nanodesk é…ç½®å‘å¯¼            [1/3]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  é€‰æ‹©å¤§æ¨¡å‹æœåŠ¡:                         â”‚
â”‚                                         â”‚
â”‚  â—‹ é˜¿é‡Œäº‘ç™¾ç‚¼ (æ¨èå›½å†…)                 â”‚
â”‚    API Key: [____________________]      â”‚
â”‚    æ¨¡å‹:     [qwen-turbo â–¼]             â”‚
â”‚                                         â”‚
â”‚  â—‹ OpenAI / OpenRouter                  â”‚
â”‚  â—‹ Ollama (æœ¬åœ°è¿è¡Œ)                    â”‚
â”‚  â—‹ å…¶ä»– (è‡ªå®šä¹‰)                        â”‚
â”‚                                         â”‚
â”‚              [  ä¸‹ä¸€æ­¥  ]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Step 2: é€šè®¯é¢‘é“**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Nanodesk é…ç½®å‘å¯¼            [2/3]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â˜‘ å¯ç”¨é£ä¹¦æœºå™¨äºº (æ¨è)                 â”‚
â”‚    App ID:     [________________]       â”‚
â”‚    App Secret: [________________]       â”‚
â”‚    [ å¦‚ä½•è·å–? ]                        â”‚
â”‚                                         â”‚
â”‚  â˜ å¯ç”¨ Telegram                        â”‚
â”‚  â˜ å¯ç”¨ Discord                         â”‚
â”‚  â˜ ä»…æœ¬åœ° CLI (ä¸å¯ç”¨ä»»ä½•é¢‘é“)           â”‚
â”‚                                         â”‚
â”‚         [ä¸Šä¸€æ­¥]      [ä¸‹ä¸€æ­¥]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Step 3: ç¡®è®¤**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Nanodesk é…ç½®å‘å¯¼            [3/3]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  é…ç½®æ‘˜è¦:                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ æœåŠ¡: é˜¿é‡Œäº‘ç™¾ç‚¼ / qwen-turbo   â”‚    â”‚
â”‚  â”‚ é£ä¹¦: å·²å¯ç”¨                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â”‚  [â˜‘ å¼€æœºè‡ªåŠ¨å¯åŠ¨]                        â”‚
â”‚  [â˜‘ å¯åŠ¨åæœ€å°åŒ–åˆ°æ‰˜ç›˜]                  â”‚
â”‚                                         â”‚
â”‚         [ä¸Šä¸€æ­¥]      [  å®Œæˆ  ]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ä¸»çª—å£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¢ Nanodesk Desktop          [â”€][â–¡][X] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  è¿è¡ŒçŠ¶æ€                      [åœæ­¢]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸŸ¢ Gateway  è¿è¡Œä¸­  ç«¯å£:18790 â”‚    â”‚
â”‚  â”‚ ğŸŸ¢ Feishu   å·²è¿æ¥  å»¶è¿Ÿ:23ms  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â”‚  å¿«æ·æ“ä½œ                               â”‚
â”‚  [ğŸ“‚ æ‰“å¼€å·¥ä½œç›®å½•]  [ğŸ“ æŸ¥çœ‹æ—¥å¿—]        â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ç³»ç»Ÿæ‰˜ç›˜èœå•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¢ Nanodesk        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¢ è¿è¡Œä¸­          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ ğŸ“± é£ä¹¦: å·²è¿æ¥     â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ æ‰“å¼€ä¸»çª—å£         â”‚
â”‚ æŸ¥çœ‹æ—¥å¿—           â”‚
â”‚ é‡æ–°é…ç½®           â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ é€€å‡º               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 5.1 ConfigManager

```python
class ConfigManager:
    """é…ç½®ç®¡ç†ï¼šè¯»å†™ config.jsonï¼ŒåŠ å¯†æ•æ„Ÿå­—æ®µ"""
    
    CONFIG_PATH = Path.home() / ".nanobot" / "config.json"
    
    def load(self) -> dict:
        """åŠ è½½é…ç½®ï¼Œè‡ªåŠ¨è§£å¯† API Key"""
        ...
    
    def save(self, config: dict) -> None:
        """ä¿å­˜é…ç½®ï¼Œè‡ªåŠ¨åŠ å¯† API Key"""
        ...
    
    def is_first_run(self) -> bool:
        """æ£€æŸ¥æ˜¯å¦éœ€è¦å¯åŠ¨é…ç½®å‘å¯¼"""
        ...
```

### 5.2 ProcessManager

```python
class ProcessManager(QObject):
    """ç®¡ç† Gateway è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ"""
    
    status_changed = Signal(str, str)  # service, status
    log_received = Signal(str)         # log line
    
    async def start_gateway(self) -> bool:
        """å¯åŠ¨ Gateway è¿›ç¨‹"""
        ...
    
    async def stop_gateway(self) -> bool:
        """åœæ­¢ Gateway è¿›ç¨‹"""
        ...
    
    def get_status(self) -> dict:
        """è·å–å„æœåŠ¡çŠ¶æ€"""
        ...
```

### 5.3 SystemTray

```python
class SystemTray(QSystemTrayIcon):
    """ç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡å’Œèœå•"""
    
    show_window = Signal()
    quit_app = Signal()
    
    def __init__(self):
        super().__init__(QIcon("resources/icons/tray_icon.ico"))
        self.setToolTip("Nanodesk")
        self._build_menu()
```

---

## 6. å¼€å‘é‡Œç¨‹ç¢‘

### Week 1-2: æ ¸å¿ƒå¼€å‘ âœ… å·²å®Œæˆ

| æ—¥æœŸ | ä»»åŠ¡ | çŠ¶æ€ |
|------|------|------|
| Day 1-2 | é¡¹ç›®ç»“æ„ + åŸºç¡€ç»„ä»¶ | âœ… å®Œæˆ |
| Day 3-4 | é…ç½®å‘å¯¼ç•Œé¢ | âœ… å®Œæˆ |
| Day 5 | é…ç½®ç®¡ç†å™¨ | âœ… å®Œæˆï¼ˆå« DPAPI åŠ å¯†ï¼‰|
| Day 6-7 | è¿›ç¨‹ç®¡ç†å™¨ | âœ… å®Œæˆï¼ˆå«æ—¥å¿—é›†æˆï¼‰|
| Day 8-9 | ä¸»çª—å£ + æ‰˜ç›˜ | âœ… å®Œæˆ |
| Day 10 | æ—¥å¿—ç³»ç»Ÿ | âœ… å®Œæˆï¼ˆLogHandler + LogViewerï¼‰|

### Week 3: æ‰“åŒ…å‘å¸ƒ ğŸš§ è¿›è¡Œä¸­

| æ—¥æœŸ | ä»»åŠ¡ | çŠ¶æ€ |
|------|------|------|
| Day 13-14 | PyInstaller æ‰“åŒ… | ğŸ“‹ å¾…æµ‹è¯• |
| Day 15-16 | Inno Setup å®‰è£…åŒ… | ğŸ“‹ å¾…æµ‹è¯• |
| Day 17 | æµ‹è¯• + æ–‡æ¡£ | ğŸ“‹ å¾…å®Œæˆ |

### Week 3: æ‰“åŒ…å‘å¸ƒ

| æ—¥æœŸ | ä»»åŠ¡ | äº§å‡º |
|------|------|------|
| Day 13-14 | PyInstaller æ‰“åŒ… | .exe æ–‡ä»¶ |
| Day 15-16 | Inno Setup å®‰è£…åŒ… | .exe å®‰è£…ç¨‹åº |
| Day 17 | æµ‹è¯• + æ–‡æ¡£ | å‘å¸ƒ v1.0 |

---

## 7. ä¾èµ–æ¸…å•

```txt
# desktop/requirements.txt
pyside6>=6.6.0
pyinstaller>=6.0
nanobot-ai>=0.x.x  # æ ¸å¿ƒåº“
```

---

## 8. æ‰“åŒ…å‘½ä»¤

```powershell
# 1. å®‰è£…ä¾èµ–
pip install -r desktop/requirements.txt

# 2. PyInstaller æ‰“åŒ…
pyinstaller desktop/main.py \
    --name="Nanodesk" \
    --windowed \
    --icon=desktop/resources/icons/logo.ico \
    --add-data="desktop/resources;resources"

# 3. Inno Setup ç”Ÿæˆå®‰è£…åŒ…
iscc installer/nanodesk.iss
```

---

## 9. é£é™©è¯„ä¼°

| é£é™© | æ¦‚ç‡ | å½±å“ | åº”å¯¹ |
|------|------|------|------|
| æ€æ¯’è½¯ä»¶è¯¯æŠ¥ | é«˜ | é«˜ | ä½¿ç”¨ PyInstaller --onefileï¼ŒåæœŸç”³è¯·ç­¾åè¯ä¹¦ |
| Windows ç‰ˆæœ¬å…¼å®¹ | ä¸­ | ä¸­ | æµ‹è¯• Win10/Win11ï¼Œæ˜ç¡®æœ€ä½ç‰ˆæœ¬ |
| é…ç½®åŠ å¯†è¢«ç ´è§£ | ä½ | ä¸­ | ä½¿ç”¨ Windows DPAPIï¼Œæ–‡æ¡£è¯´æ˜å®‰å…¨é™åˆ¶ |
| æ‰“åŒ…ä½“ç§¯è¿‡å¤§ | ä¸­ | ä½ | PyInstaller UPX å‹ç¼©ï¼Œåˆ†ç¦»å¯é€‰ç»„ä»¶ |

---

## 10. éªŒæ”¶æ ‡å‡†

- [ ] å…¨æ–° Windows ç”µè„‘ï¼ŒåŒå‡»å®‰è£…åŒ…ï¼Œ5åˆ†é’Ÿå®Œæˆé…ç½®å¹¶è¿è¡Œ
- [ ] é…ç½®å‘å¯¼æ”¯æŒ 4 ç§ Provider åˆ‡æ¢
- [ ] ç³»ç»Ÿæ‰˜ç›˜å¯å¯åŠ¨/åœæ­¢/æŸ¥çœ‹çŠ¶æ€
- [ ] é…ç½®åŠ å¯†å­˜å‚¨ï¼Œå…¶ä»–ç”¨æˆ·æ— æ³•è¯»å–
- [ ] å®‰è£…åŒ…ä½“ç§¯ < 100MB

---

## é™„å½•

- [FEISHU_SETUP.md](./FEISHU_SETUP.md) - é£ä¹¦é…ç½®æŒ‡å—
- [UPSTREAM_PRS.md](./UPSTREAM_PRS.md) - ä¸Šæ¸¸åŠŸèƒ½è·Ÿè¸ª
