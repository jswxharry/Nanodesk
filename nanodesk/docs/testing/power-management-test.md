# 电源管理测试用例

## 测试目标

验证：Gateway 运行时，插电阻止睡眠，电池允许睡眠

---

## 前置条件

- Windows 10/11
- 已配置飞书（能收到消息）
- 笔记本最佳（可测电池场景）

---

## 测试 1：插电阻止睡眠（必须测）

**步骤**:

1. **插电**，启动 Gateway
2. **检查**: 运行 `powercfg /requests`，看到 `python.exe` = ✅
3. **关屏**: Win + L 锁屏（或关闭显示器）
4. **发消息**: 从手机飞书发送消息
5. **验证**: 10秒内收到回复 = ✅
6. **停止** Gateway
7. **检查**: 再运行 `powercfg /requests`，没有 `python.exe` = ✅

**通过标准**: 第2、5、7步都通过

---

## 测试 2：电池允许睡眠（笔记本测）

**步骤**:

1. **拔电源**，用电池启动 Gateway
2. **检查**: `powercfg /requests`，**没有** `python.exe` = ✅
3. **关屏**: Win + L，等待 10 分钟
4. **验证**: 电脑进入睡眠（风扇停/灯灭）= ✅
5. **发消息**: 手机飞书发送消息
6. **验证**: **收不到**消息（因为电脑睡了）= ✅

**通过标准**: 第2、4、6步都通过

---

## 测试 3：单实例锁（必须测）

**步骤**:

1. **终端1**: `nanodesk gateway`（保持运行）
2. **终端2**: `nanodesk gateway`（应提示 "already running" 并退出）= ✅
3. **终端1**: Ctrl+C 停止
4. **终端2**: 再运行 `nanodesk gateway`（应成功启动）= ✅

**通过标准**: 第2、4步都通过

---

## 快速命令

```powershell
# 检查是否有 Python 阻止睡眠
powercfg /requests | findstr python

# 查看 Gateway 日志
Get-Content ~/.nanodesk/logs/gateway_$(Get-Date -Format 'yyyyMMdd').log -Tail 20
```

---

## 测试结果

填到报告里：

| 测试 | 结果 | 备注 |
|------|------|------|
| 插电阻止 | ⬜ 通过 ⬜ 失败 | |
| 电池睡眠 | ⬜ 通过 ⬜ 失败 ⬜ N/A | 无笔记本 |
| 单实例锁 | ⬜ 通过 ⬜ 失败 | |
