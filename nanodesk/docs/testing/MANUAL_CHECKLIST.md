# 手动测试清单

> 以下测试需要用户手动执行，涉及 GUI、真实账号、对话质量判断

---

## 测试前准备

1. AI 已完成 [AI_CHECKLIST.md](./AI_CHECKLIST.md) 且全部通过
2. 准备飞书机器人账号（测试飞书集成）
3. 准备 LLM API Key（推荐阿里云百炼）

---

## 1. 桌面应用测试

### 1.1 启动测试
**步骤**:
```powershell
.\nanodesk\scripts\run_desktop.ps1
```

**验证点**:
- [ ] 窗口标题显示 "Nanodesk Desktop v0.2.1"
- [ ] 状态栏显示 "就绪"
- [ ] 无报错弹窗

**截图**: [在此粘贴截图]

### 1.2 配置向导（首次启动）
**步骤**:
1. 删除现有配置: `rm ~/.nanobot/config.json`
2. 启动桌面应用

**验证点**:
- [ ] 自动弹出配置向导
- [ ] Step 1: LLM Provider 配置正常
- [ ] Step 2: 飞书配置正常（可跳过）
- [ ] Step 3: 确认页面显示配置摘要
- [ ] 保存后自动生成 config.json

**截图**: [在此粘贴截图]

### 1.3 Gateway 启停
**步骤**:
1. 点击 "启动 Gateway"
2. 等待 5 秒
3. 点击 "停止 Gateway"

**验证点**:
- [ ] 启动后状态灯变绿
- [ ] 日志窗口显示 "Gateway started"
- [ ] 停止后状态灯变红/灰
- [ ] 日志窗口显示 "Gateway stopped"

**截图**: [在此粘贴截图]

### 1.4 日志查看
**步骤**:
1. 启动 Gateway
2. 点击 "查看日志"

**验证点**:
- [ ] 弹出日志窗口
- [ ] 显示实时日志滚动
- [ ] 包含时间戳和日志级别

### 1.5 系统托盘
**步骤**:
1. 最小化窗口
2. 右键点击系统托盘图标
3. 选择 "退出"

**验证点**:
- [ ] 托盘图标显示正常
- [ ] 右键菜单包含：显示/隐藏、启动、停止、退出
- [ ] 退出后 Gateway 进程停止

---

## 2. 上游功能测试

### 2.1 内存系统 v2
**步骤**:
```powershell
nanodesk agent
```
进行 10+ 轮对话，主题围绕同一个话题。

**验证点**:
- [ ] Agent 能记住前文上下文
- [ ] 对话流畅，无明显延迟增加
- [ ] 内存使用稳定（无明显泄漏）

**测试对话示例**:
```
用户: 你好，我想聊一下我的项目 Nanodesk
AI: [回复]
用户: 它有哪些功能？
AI: [应提到 Nanodesk 是桌面应用]
用户: 怎么安装？
AI: [应延续 Nanodesk 话题]
...
```

### 2.2 /new 命令
**步骤**:
在飞书或 CLI 中输入:
```
/new
```

**验证点**:
- [ ] 收到 "已创建新会话" 提示
- [ ] 上下文被清空（不再记得之前的话题）
- [ ] 历史会话被归档（可在日志中看到）

### 2.3 内存整合
**步骤**:
1. 对话中多次使用 `/new`
2. 询问之前某个话题的内容

**验证点**:
- [ ] 能正确检索历史会话内容
- [ ] 回复中包含 "根据之前的对话..."

### 2.4 飞书卡片修复
**步骤**:
在飞书中发送带标题的消息：
```
## 这是标题
这是正文内容
```

**验证点**:
- [ ] 飞书卡片正常显示
- [ ] 标题格式正确（无错乱）
- [ ] 无多余的 HTML 标签显示

---

## 3. 搜索工具测试

### 3.1 DuckDuckGo 搜索
**步骤**:
```
使用 ddg_search 搜索 "最新 AI 新闻"
```

**验证点**:
- [ ] 返回搜索结果列表
- [ ] 包含标题、URL、摘要
- [ ] 结果数量符合预期

**截图/结果**: [在此粘贴]

### 3.2 浏览器搜索
**步骤**:
```
使用 browser_search 搜索 "Python 教程"
```

**验证点**:
- [ ] 浏览器启动（可能有短暂延迟）
- [ ] 返回带 URL 和摘要的结果
- [ ] 支持动态页面（JS 渲染）

**注意**: 首次使用会下载 Chromium，可能需要 1-2 分钟

### 3.3 浏览器抓取
**步骤**:
```
使用 browser_fetch 抓取 https://www.example.com
```

**验证点**:
- [ ] 返回 JSON 格式内容
- [ ] 包含 title、text、url
- [ ] 页面内容被正确提取

---

## 4. 集成测试

### 4.1 工具调用链
**步骤**:
```
搜索最新 AI 新闻并总结
```

**验证点**:
- [ ] 自动调用 ddg_search
- [ ] 获取搜索结果
- [ ] LLM 基于结果生成总结
- [ ] 总结内容准确、相关

### 4.2 定时任务（at 参数）
**步骤**:
```
使用 cron_tool, action="add", at="2026-02-14T10:00:00", message="测试定时任务"
```

**验证点**:
- [ ] 成功创建定时任务
- [ ] 返回任务 ID
- [ ] 到指定时间后收到消息

---

## 5. 回归测试（确保没坏）

### 5.1 基础对话
**步骤**:
```
你好
```

**验证点**:
- [ ] 正常回复
- [ ] 无报错

### 5.2 文件操作
**步骤**:
```
列出工作目录的文件
```

**验证点**:
- [ ] 使用 list_dir 工具
- [ ] 正确返回文件列表

### 5.3 Shell 执行
**步骤**:
```
执行 echo "hello"
```

**验证点**:
- [ ] 正确返回 "hello"
- [ ] 无安全警告误报

---

## 测试完成确认

### 通过标准
- [ ] 所有 P0 测试通过
- [ ] P1 失败项不超过 2 个
- [ ] 无数据丢失或安全问题

### 合并建议
- [ ] **全部通过**: 可合并 develop → nanodesk
- [ ] **部分问题**: 修复后复测
- [ ] **严重问题**: 暂缓合并

### 填写测试报告
完成测试后，复制 `test-report-template.md` 并填写结果。

---

## 快速问题排查

| 问题 | 解决方式 |
|------|---------|
| Gateway 启动失败 | 检查 18790 端口是否被占用 |
| 飞书收不到消息 | 检查 App ID/Secret，确认权限已开通 |
| 搜索工具报错 | 确认 `duckduckgo-search` 已安装 |
| 浏览器工具报错 | 执行 `playwright install chromium` |
| 桌面应用闪退 | 查看 `~/.nanobot/logs/` 错误日志 |
